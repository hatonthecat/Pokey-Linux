XCOMM $Xorg: Imakefile,v 1.3 2000/08/17 19:46:24 cpqbld Exp $




XCOMM $XFree86: xc/lib/font/Imakefile,v 3.33 2001/08/27 17:40:58 dawes Exp $

#include <Server.tmpl>

#define	IHaveSubdirs

#define DoNormalLib NormalLibFont
#define DoSharedLib SharedLibFont
#define DoExtraLib SharedLibFont
#define DoDebugLib DebugLibFont
#define DoProfileLib ProfileLibFont

#if !BuildFontLib
#define LibCreate NO
#else
#define LibCreate YES
#endif

#if BuildLibraries
#define LibInstall YES
#else
#define LibInstall NO
#endif

#if BuildLibraries
STUBDIRS = stubs
#endif

LIBNAME = Xfont
SOREV = $(SOFONTREV)

#ifndef SeparateSharedCompile
#define SeparateSharedCompile YES
#endif
#if NormalLibFont && SharedLibFont && SeparateSharedCompile
STATIC_OBJSDIR = unshared/
#endif

#ifdef SharedXfontReqs
REQUIREDLIBS = SharedXfontReqs
#endif


#if BuildBuiltinFonts
        BUILTINDIRS = builtins
  BUILTINSHAREDOBJS = builtins/?*.o
  BUILTINSTATICOBJS = builtins/$(STATIC_OBJSDIR)?*.o
   BUILTINDEBUGOBJS = builtins/debugger/?*.o
 BUILTINPROFILEOBJS = builtins/profiled/?*.o
       BUILTINDONES = builtins/DONE
#endif

#bitmap fontfile fc fontcache

       SUBDIRS =  bitmap fontfile \
		 $(SPEEDODIRS) $(TYPE1DIRS) \
		 $(FREETYPEDIRS) $(XTTDIRS) $(BUILTINDIRS) \
		 util $(STUBDIRS)


#bitmap/?*.o fontfile/?*.o fc/?*.o fontcache/?*.o
   SHARED_OBJS = bitmap/?*.o fontfile/?*.o \
		 $(SPEEDOSHAREDOBJS) $(TYPE1SHAREDOBJS) \
		 $(FREETYPESHAREDOBJS) $(XTTSHAREDOBJS) \
		 $(BUILTINSHAREDOBJS) util/?*.o

#bitmap/$(STATIC_OBJSDIR)?*.o fontfile/$(STATIC_OBJSDIR)?*.o \
#		 fc/$(STATIC_OBJSDIR)?*.o fontcache/$(STATIC_OBJSDIR)?*.o

   STATIC_OBJS = bitmap/$(STATIC_OBJSDIR)?*.o fontfile/$(STATIC_OBJSDIR)?*.o  \
		 $(SPEEDOSTATICOBJS) $(TYPE1STATICOBJS) \
		 $(FREETYPESTATICOBJS) $(XTTSTATICOBJS) \
		 $(BUILTINSTATICOBJS) util/$(STATIC_OBJSDIR)?*.o
    DEBUG_OBJS = bitmap/debugger/?*.o fontfile/debugger/?*.o fc/debugger/?*.o \
		 fontcache/debugger/?*.o \
		 $(SPEEDODEBUGOBJS) $(TYPE1DEBUGOBJS) \
		 $(FREETYPEDEBUGOBJS) $(XTTDEBUGOBJS) \
		 $(BUILTINDEBUGOBJS) util/debugger/?*.o
  PROFILE_OBJS = bitmap/profiled/?*.o fontfile/profiled/?*.o fc/profiled/?*.o \
		 fontcache/profiled/?*.o \
		 $(SPEEDOPROFILEOBJS) $(TYPE1PROFILEOBJS) \
		 $(FREETYPEPROFILEOBJS) $(XTTPROFILEOBJS) \
		 $(BUILTINPROFILEOBJS) util/profiled/?*.o
         DONES = bitmap/DONE fontfile/DONE fc/DONE fontcache/DONE \
		 $(SPEEDODONES) $(TYPE1DONES) \
		 $(FREETYPEDONES) $(XTTDONES) \
		 $(BUILTINDONES) util/DONE

#if BuildServer && DoLoadableServer
      BASEDIRS = fontfile fc util fontcache
   BASELIBOBJS = fontfile/$(STATIC_OBJSDIR)?*.o fc/$(STATIC_OBJSDIR)?*.o \
		 util/$(STATIC_OBJSDIR)?*.o fontcache/$(STATIC_OBJSDIR)?*.o 
      BASEOBJS = fontfile/module/ffcheck.o fontfile/module/register.o \
		 util/private.o
     BASEDONES = fontfile/DONE fontfile/module/DONE fc/DONE util/DONE \
		 fontcache/DONE
#endif

#if HasParallelMake
MakeMutex($(SUBDIRS) $(DONES))
#endif

#if HasGnuMake || HasBsdMake
$(DONES): $(SUBDIRS)
#endif

#include <Library.tmpl>

#undef _LinkBuildLibrary
#define _LinkBuildLibrary(lib) LinkBuildLibrary(lib)

#if LibCreate
#if NormalLibFont
NormalDepLibraryTarget($(LIBNAME),$(SUBDIRS) $(DONES),$(STATIC_OBJS))
#if LibInstall
InstallLibrary($(LIBNAME),$(USRLIBDIR))
#endif /* LibInstall */
#endif /* NormalLibFont */

#if SharedLibFont
SharedDepLibraryTarget($(LIBNAME),$(SOREV),$(SUBDIRS) $(DONES),$(SHARED_OBJS),.,.)
#if LibInstall
InstallSharedLibrary($(LIBNAME),$(SOREV),$(SHLIBDIR))
#endif /* LibInstall */
#endif /* SharedLibFont */

#if DebugLibFont
DebuggedDepLibraryTarget($(LIBNAME),$(SUBDIRS) $(DONES),$(DEBUG_OBJS))
#if LibInstall
InstallLibrary($(LIBNAME)_d,$(USRLIBDIR))
#endif /* LibInstall */
#endif /* DebugLibFont */

#if ProfileLibFont
ProfiledDepLibraryTarget($(LIBNAME),$(SUBDIRS) $(DONES),$(PROFILE_OBJS))
#if LibInstall
InstallLibrary($(LIBNAME)_p,$(USRLIBDIR))
#endif /* LibInstall */
#endif /* ProfileLibFont */
#endif /* LibCreate */

#if BuildServer && DoLoadableServer
NormalDepLibraryTarget(fontbase,$(BASEDIRS) $(BASEDONES),$(BASELIBOBJS))
NormalDepRelocatableTarget(fontbase,$(BASEDIRS) $(BASEDONES),$(BASEOBJS))
#endif


ForceSubdirs($(SUBDIRS))

DependSubdirs($(SUBDIRS))
