Installation Steps

For building Yocto images, I will be using a Lenovo Thinkpad E420 from 2012. 
It has an i3 2350M (x86-64-v2) with 6GB RAM. It originally came with 4GB DDR3.
A 120GB SSD was installed a while back ("upgraded" from a 500GB HDD with 8KB cache).

Yocto 5.0 says around 90GB storage is needed and 8GB of RAM.
I estimate I will not need that much, so I will wing it.

I will be installing Ubuntu 24.04.3 LTS. 
Ubuntu uses around 25GB. I should have around 85GB left over. 

https://ubuntu.com/download/desktop
I used an 8GB SD card with USB-SD adapter. The ISO file is 6GB

I used Raspberry Pi Imager to erase and flash the drive 
(it works remarkably well, despite Windows 10 errors saying otherwise)
This guide confirms 8GB fits: https://phoenixnap.com/kb/install-ubuntu-24-04

https://www.raspberrypi.com/software/

After installing Ubuntu, I have 99GB left over. Better than expected.

I used this tutorial to install the required files for Yocto:


https://www.youtube.com/watch?v=KpRzZ_JdVK8

I followed the YT video until it got to the part about installing/upgrading Python3.

So in the first section (up to around 0:30, I installed git, then tar. 

The commands for "sudo apt get install gawk wget..." weren't working so I jumped (back or forward) to the Part 2 tutorial, which seems to have filled in some of the blanks.

https://kickstartembedded.com/2021/12/19/yocto-part-2-setting-up-ubuntu-host/

$ sudo apt update

The first one worked, but it listed optional updates. I did not select them, although I might. (Edit: I got a prompt window asking to install 180MB+ of updates, so I selected yes)

$ sudo apt install git git-lfs tar python3 python3-pip gcc 

This installed the items that appeared to be in the 0:30 mark. Actually, I will return to the video tutorial:

The 0:32 mark gets a little confusiung because it's not clear if the command worked on the first line and then the sudo apt install without line breaks /  seems to be the correct formatting.

So I will resume copying the tutorial and include the ones from the webpage, possibly out of order. 

The video uses a slightly shorter command- it includes everything in the webpage up until :

"sudo apt install gawk wget git diffstat unzip texinfo gcc build-essential chrpath socat cpio python3 python3-pip python3-pexpect xz-utils debianutils iputils-ping python3-git python3-jinja2 libegl1-mesa libsdl1.2-dev pylint3 xterm"

When I tried to use the entire command, it said "command not found." Possiblky one of the instructions later on were not recognized, or incorrect, or both:

$ sudo apt install gawk wget git diffstat unzip texinfo gcc build-essential chrpath socat cpio python3 python3-pip python3-pexpect xz-utils debianutils iputils-ping python3-git python3-jinja2 libegl1-mesa libsdl1.2-dev pylint3 xterm python3-subunit mesa-common-dev zstd liblz4-tool

Maybe I will need to install the rest separately (it might be in the later part of the video.)

errors: unable to locate package libegl1-mesa
unable locate package pylint3 (possibly newer version and it got moved).

Also got an error: externally-managed-environment. This is probably a newb error (even this discussion points to a common workaround that is NOT recommended: 

https://discuss.python.org/t/the-most-popular-advice-on-the-internet-for-error-externally-managed-environment-is-to-force-packages-to-be-system-installed/56900)

So I guess I need to figure out which packages are official python and which are not authorized, at least to be run system wide, and should look into the virtual enviornment option.

Found a few pages that identify the issue for Ubuntu 24.04 (but still searching for the cause and solution):

https://lists.yoctoproject.org/g/docs/topic/libegl1_mesa_not_available_in/105760426

https://forum.beagleboard.org/t/why-i-cant-install-the-host-package-of-yocto-project/37126/4

I suppose I could just find a Yocto installation tutorial that was written after Ubuntu 24.04 was released, but I might just wait on that if the solution is simple enough (2 errors isn't as bad as it could be- might be a simple fix)

Edit: that will be the current plan:

https://docs.yoctoproject.org/ref-manual/system-requirements.html#ubuntu-and-debian

sudo apt-get install build-essential chrpath cpio debianutils diffstat file gawk gcc git iputils-ping libacl1 locales python3 python3-git python3-jinja2 python3-pexpect python3-pip python3-subunit socat texinfo unzip wget xz-utils zstd

Progress^ this prompted 17.1MB of additional packages, so it got what the 2021 tutorial missed (no surprises, but eh)

$ locale --all-locales | grep en_US.utf8 (already set)

$ sudo dpkg-reconfigure locales

sudo apt install git librsvg2-bin locales make python3-saneyaml python3-sphinx-rtd-theme sphinx (added 31MB)

sudo apt install fonts-freefont-otf latexmk tex-gyre texlive-fonts-extra texlive-fonts-recommended texlive-lang-all texlive-latex-extra texlive-latex-recommended texlive-xetex (4,428M additional disk space needed, wowza lol)

(yes i know, that should have been my first approach, but sometimes using a tutorial for a project similar to mine seems more interesting at first, at lesat)

Installation of documentation PDF packs is for multiple languages. The i3 2350M is a dual core, 4 threaded processor. 

Threading works quite well for simple installation and utilizes all four threads around 30-75%. 
The download is only 1.8GB and I could use an ethernet cable but the installation files and package updates are infrequent so it might even complete the installation slower than it can download some of the files on ethernet. Unlikely a bottleneck, but not always.
(2.4Ghz is around 40Mbps instead of the maximum speed I have) 


I realize these instructions are for Yocto 5.3.999. 
Now I am unsure if this is the version I want to run, since it requires 32GB RAM, and may need to revert to 5.0 to avoid some unforseen issue.
I am unsure if it will affect small builds, but still may need to check the 5.0 installation guide (or an unofficial guide for that)

Yep, that was the issue. The current version doesn't mention the version number, but the legacy/supported versions prior to are visible in the placeholder:

https://docs.yoctoproject.org/5.0/ref-manual/system-requirements.html#ubuntu-and-debian

The first command adds just 249 KB of disk space (most were already installed by the 2021 Kickstart Embedded tutorial or the 5.3 one). 
$ sudo apt install gawk wget git diffstat unzip texinfo gcc build-essential chrpath socat cpio python3 python3-pip python3-pexpect xz-utils debianutils iputils-ping python3-git python3-jinja2 libegl1-mesa libsdl1.2-dev python3-subunit mesa-common-dev zstd liblz4-tool file locales libacl1

So, after completing the 5.0 instructions (minus the oss4 step since it wasn't installed), I had to create the Yocto directory along with the Poky folder. When I tried to proceed to the next section 1.5.1, it says to cd Poky. Realizing it wasn't installed, I jumped back to the next youtube video, since the above video link completed with the pip and python scripts, which might have already been in the top section 1.4.1.

So the YT video has a convenient instruction (Part 3: https://kickstartembedded.com/2021/12/21/yocto-part-3-build-run-your-first-ever-image/)

https://youtu.be/ddwaLPzezuo?t=9

$ mkdir yocto
$ cd yocto

$ git clone git://git.yoctoproject.org/poky (221MB as of this writing - it was 179MB in 2021)
$ cd poky
$ git checkout -b dunfell origin/dunfell (Dunfell is Yocto 3.1, so might it be as easy as just changing the letters to scarthgap? more or less)

I cd'd to poky and then ran:

$git checkout -b scarthgap origin/scarthgap

Preserving the format to see if it would run (the 5.0 has a script file to run instead/in addition, but first I tried that and got this:

"branch 'scarthgap" set up to track 'origin\scarthgap

"Switched to a new branch scarthgap'. So maybe it worked?

Obviously I don't want to mix the directories where builds get made, but some are created by default.

Maybe I will try this next $ scripts/install-buildtools

Maybe this build is a chimera at best, and a chimera at best.

Update: I tried the 2021 tutorial and it autogenerated a build directory, as intended:

"$ source oe-init-build-env <name of your build directory>

If you donâ€™t specify a name, a build directory named build is automatically created. "

This way I know it worked. 

The next instructions I will try out the minimal build, which should require the least compile time. It seems like the Sato environment is still developed/featured- i did speculate what happened to that mobile enviroment in the h.sapiens file of this main repository. I obviously don't know enough about Yocto development, but I probably haven't looked hard enough for mobile desktop environments.

https://www.linkedin.com/posts/michaelopdenacker_important-change-for-the-next-yocto-releases-activity-7393585408602718208-4mfm

"poky" as a reference distribution remains available of course.

Former releases of Yocto (Walnascar, Scarthgap, Kirkstone) are not impacted."

Apparently this change affects _a_ Poky directory (on the git repository or the local, or both), but it doesn't affect the 5.0 release. "Important change for the next Yocto releases: the  "poky" repository is no longer maintained as a combo layer. You now have to switch to individual clones of bitbake, openembedded-core, meta-yocto and yocto-docs, or use the new "bitbake-setup" tool.

$ source oe-init-build-env <name of your build directory>

$ bitbake core-image-sato --runall=fetch

$ bitbake core-image-sato

"Depending on your CPU capability, it may take anywhere from few tens of minutes to maybe even a few hours (took 2.5 hours for us!)."

It will be curious of what the build time will be on this 4 threaded CPU. I imagine the SSD should help, but I assume they are using one too (in 2021, i'd expect). 
But who knows, maybe mine will take 5 hrs.

I was going to bake the minimal, but I will benchmark my laptop by building the Sato image.

An error occurred: 

https://lists.yoctoproject.org/g/poky/topic/problem_run_bitbake_on/111656575  

But you need to have sudo permission.

    "Disable this restriction on the entire system for one boot by executing echo 0 | sudo tee /proc/sys/kernel/apparmor_restrict_unprivileged_userns. 
This setting is lost on reboot.
This similar to the previous behaviour, but it does not mitigate against kernel exploits that abuse the unprivileged user namespaces feature.

    Disable this restriction using a persistent setting by adding a new file (/etc/sysctl.d/60-apparmor-namespace.conf) with the following contents:

    kernel.apparmor_restrict_unprivileged_userns=0

    Reboot. This is similar to the previous behaviour, but it does not mitigate against kernel exploits that abuse the unprivileged user namespaces feature."

I guess I will have to temporarily disable the restriction for this test. 
There are probably other ways to work around that, but I won't be using this machine for other documents, so the risk is less.

I won't enable the persistent option by creating the config file for now, until I understand more of the block
(i am guessing it's just the kernel and Ubuntu trying to protect naive users from blindly following online instructions ;)


The temp option worked. All 4 threads are operating. Parsing takes around 1 minute. 568 Setscene tasks. 1136 tasks. 
Running 4 at a time. Only 3.4GB out of 6.1GB in use (4.4MB swap). It's downloading and running tasks at the same time.
At 55% complete. Probably only takes 10 minutes at most.

Binutilis 2.4 took just under 7 minutes and 30 seconds, followed by glibc, which was around 4 minutes.
I am not sure if this refers to the fetching or installing of the packages, but a little over 10 minutes to complete all 1136 tasks. 
It actually seems to be downloading the tasks right now for the last 3 rpm and yocto, so that appeared to be the bottleneck 
(5 GHz and Ethernet wouldn't help- speed is 550KB/s on average )

The Yocto-linux 6.6.111+git-r0 do_fetch is at 860Kb/s and only at 26% complete. likely a server issue or mirror not running as well as it should?

It seems to have slowed down to a crawl around 26%. 
It's now at 30% and 20 minutes elapsed (for just that 2nd to last task #1135- fetching began around 30 minute ago).
This might take 60+ minutes. Threads are around 25% utilized (per thread). 
Possibly lots of users download this default file and its possible that the speed is rate limited by the server due to preventing bots from saturating their bandwidth.

Possible similar references:
https://news.ycombinator.com/item?id=42722659 
https://www.youtube.com/watch?v=SvxZ3MtraSA

It appears to have completed downloading sometime while I was away. 
At 1hr and 26 minutes, it's 87% complete with another task as part of task 1135/1136. 
Possibly unpacking as the threads' utilization are 75%+ and using 4.1GB of RAM now (+490MB of swap).

The bitbake command will happen next. $ bitbake core-image-sato

Do I even have qemu installed yet? Checking soon.

It's for an A5 board, the Jupiter Nano. Copying this tutorial will allow me to get familiar with the autopopulating directories of Yocto and its related tools.

Then I will move to a different ISA, most likely.

